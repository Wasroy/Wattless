# üöÄ NERVE : MASTER BLUEPRINT (Tech & Business)
**Document de r√©f√©rence complet (PRD + Specs Architecture)**
**Version :** 3.0 ‚Äî Vision Mondiale

---

## 1. VISION & EXECUTIVE SUMMARY
**La Vision :** Nerve est un Orchestrateur Cloud Pr√©dictif √† l'√©chelle mondiale. Nous scannons en temps r√©el les serveurs, la m√©t√©o, l'√©nergie et les √©v√©nements sociaux/environnementaux sur toute la plan√®te pour envoyer chaque calcul l√† o√π c'est le moins cher, le plus vert et le plus disponible ‚Äî √† l'instant T.
**La Promesse Client :** Vos calculs lourds tournent toujours au meilleur endroit du monde, automatiquement. Prix minimal, impact carbone minimal, z√©ro interruption.

**Le Principe Fondamental : On d√©place le calcul, jamais les donn√©es.**
Les donn√©es du client restent stock√©es l√† o√π elles sont. Seule l'instruction de calcul (le code, le job) est envoy√©e vers le serveur optimal. Un job p√®se quelques Ko/Mo ‚Üí les frais de transfert sont n√©gligeables.

**Le Job to be Done (JTBD) :**
> "Quand ma facture Cloud explose √† cause de mes calculs lourds (IA, Data, Rendu), je veux que mon calcul soit automatiquement envoy√© sur le meilleur serveur au monde √† cet instant ‚Äî le moins cher, le plus vert, le moins charg√© ‚Äî sans que je g√®re quoi que ce soit."

---

## 2. R√àGLES FONDAMENTALES
1. **Arbitrage MONDIAL, pas local :** Nerve compare les serveurs du monde entier (AWS, GCP, Azure ‚Äî toutes r√©gions). Un calcul peut partir de Francfort au Br√©sil si c'est moins cher et plus vert l√†-bas. C'est possible parce qu'on ne d√©place que le calcul (quelques Ko/Mo), jamais les donn√©es lourdes ‚Üí les Egress Fees sont n√©gligeables.
2. **On ne touche jamais au Stateful :** Nerve ignore totalement les bases de donn√©es (PostgreSQL, MongoDB). On ne g√®re que le *Stateless* et les calculs *Asynchrones* (Workers). Les donn√©es restent fixes, seule la puissance de calcul voyage.
3. **D√©cision multi-facteurs :** Le choix du serveur ne repose pas que sur le prix. Nerve croise : prix Spot, m√©t√©o locale (solaire/√©olien = √©nergie pas ch√®re), charge des datacenters, et √©v√©nements sociaux/environnementaux (ex: Super Bowl aux US ‚Üí serveurs US surcharg√©s ‚Üí on d√©cale en Europe).

---

## 3. CIBLE CLIENT (ICP - Ideal Customer Profile)
L'outil est pens√© pour les architectures modernes (Kubernetes). Nos premiers clients sont :
* **Startups IA :** Entra√Ænement de mod√®les, inf√©rence de LLMs.
* **AdTech / Data :** Traitement de donn√©es massives asynchrones.
* **Studios 3D / Vid√©o :** Jobs de rendu lourds.
*(Note : On exclut les banques et la sant√© pour le moment : cycles de vente trop longs, compliance ISO/SOC2 trop lourde pour un MVP).*

---

## 4. ARCHITECTURE TECHNIQUE & STACK
L'architecture s'int√®gre nativement dans les clusters Kubernetes des clients. L'objectif est une empreinte ultra-l√©g√®re et une latence quasi-nulle.

* **Moteur & Orchestration :** `Go (Golang)` - Obligatoire pour interagir proprement et rapidement avec l'API Kubernetes.
* **Mod√®le Pr√©dictif (IA) :** `Python + PyTorch` (Mod√®les l√©gers type LSTM/Transformers pour la pr√©diction de s√©ries temporelles sur les prix et coupures).
* **Cache & D√©cision temps r√©el :** `Redis` (Stockage des prix Spot AWS/GCP √† la milliseconde).
* **Observabilit√© :** `Prometheus` (r√©cup√©ration des m√©triques) + `Grafana` (Dashboard client).
* **D√©ploiement :** Package `Helm` (Installation en 1 ligne : `helm install nerve`).

---

## 5. LES 5 MODULES DU PRODUIT (FEATURES)

### Module 1 : Workload Profiler (L'Intercepteur)
* **M√©canisme :** Utilisation d'un `Mutating Admission Webhook` Kubernetes.
* **R√¥le :** √Ä chaque lancement d'un Pod, Nerve intercepte la requ√™te. Si c'est tagg√© "Asynchrone/Batch", Nerve injecte dynamiquement des `nodeSelectors` et `tolerations` pour forcer l'ex√©cution sur une machine g√©r√©e par Nerve. S'il s'agit d'une API web live (Synchrone) ou d'une DB, Nerve laisse passer sans rien toucher.

### Module 2 : Global Intelligence Engine (Le Radar Mondial)
* **M√©canisme :** Scraping + APIs en continu sur l'ensemble de la plan√®te.
* **Sources de donn√©es :**
  * **Prix Cloud :** APIs AWS EC2 Spot, GCP Preemptible, Azure Spot ‚Äî toutes r√©gions mondiales, en temps r√©el.
  * **M√©t√©o & √ânergie :** APIs m√©t√©orologiques (OpenWeather, etc.) + APIs √©nergie (Electricity Maps, RTE) pour savoir o√π l'√©nergie renouvelable est abondante (soleil, vent) ‚Üí serveurs aliment√©s par du vert = moins cher et plus √©co.
  * **√âv√©nements sociaux & environnementaux :** D√©tection d'√©v√©nements majeurs (Super Bowl, Black Friday, catastrophes naturelles, etc.) qui surchargent les datacenters d'une zone ‚Üí signal pour √©viter ces r√©gions et d√©caler le calcul ailleurs.
* **Output :** Un **score composite par r√©gion** en temps r√©el : `Score = f(prix, √©nergie verte, charge datacenter, √©v√©nements)`. Le Scheduler utilise ce score pour choisir la meilleure destination mondiale.

### Module 3 : Spot Sniper & Scheduler (Le C≈ìur du R√©acteur)
* **M√©canisme :** Un `Custom Kubernetes Scheduler` coupl√© √† un gestionnaire d'√©v√©nements API Cloud multi-providers (AWS, GCP, Azure).
* **R√¥le :** Place les Pods asynchrones sur les serveurs Spot les moins chers **au niveau mondial**. Le scheduler compare toutes les r√©gions de tous les providers pour trouver le meilleur spot sur la plan√®te √† l'instant T.
* **Le Bouclier (Graceful Termination) :** Si l'IA pr√©dit une coupure ou si un provider envoie un signal d'interruption, Nerve d√©clenche instantan√©ment un `Cordon` et `Drain` sur le Node concern√©, et replace le Pod sur un Node s√ªr (potentiellement dans une autre r√©gion/pays) en < 10 secondes. Z√©ro downtime.

### Module 4 : Green Time-Shifter (Le Planificateur √âcolo)
* **M√©canisme :** Job Queue locale + int√©gration APIs mondiales (Electricity Maps, RTE, APIs m√©t√©o locales).
* **R√¥le :** Permet au client de tagger un job avec `nerve.io/eco-mode: true`. Nerve ne se limite pas √† attendre que le r√©seau local soit vert ‚Äî il cherche **sur toute la plan√®te** o√π l'√©nergie est la plus verte √† l'instant T (ex: il fait grand soleil au Br√©sil avec des panneaux solaires ‚Üí on envoie le calcul l√†-bas). Combine donn√©es m√©t√©o en temps r√©el + mix √©nerg√©tique par r√©gion.

### Module 5 : Dashboard FinOps/GreenOps
* **M√©canisme :** UI l√©g√®re requ√™tant Prometheus.
* **R√¥le :** Afficher la valeur : √âconomies r√©alis√©es ce mois-ci ($), Nombre de coupures √©vit√©es, Kg de CO2 √©conomis√©s.

---

## 6. SP√âCIFICATIONS & CONTRAINTES DE CODE (SPECS MILITAIRES)
L'√©quipe tech doit graver ces r√®gles dans le marbre. Un CTO client nous d√©sinstallera imm√©diatement si on ne les respecte pas :

* **Performances (Z√©ro Overhead) :** L'agent Nerve doit consommer `< 50 Mo de RAM` et `< 0.1 vCPU`. La latence d'interception du Webhook doit √™tre `< 50ms`.
* **S√©curit√© & RBAC :** Acc√®s strictement limit√© aux permissions `Nodes` et `Pods`. Interdiction absolue de requ√™ter les `Secrets`, `ConfigMaps` ou `PersistentVolumes`.
* **Fail-Safe (No Single Point of Failure) :** Si l'agent Nerve crash ou perd internet : le cluster DOIT repasser automatiquement sur le Scheduler par d√©faut de Kubernetes.

---

## 7. GESTION DES RISQUES & EDGE CASES (POUR LES D√âVELOPPEURS)
L'algorithme doit int√©grer ces parades d√©fensives :
* **Cas A - P√©nurie mondiale de GPU en Spot :** Coder un "Fallback Timeout". Si aucun GPU Spot n'est trouv√© **sur aucune r√©gion du monde** en 5 min, Nerve d√©ploie le Pod sur un GPU On-Demand plein tarif. Le calcul ne doit jamais √™tre bloqu√©.
* **Cas B - Boucle infinie d'√©viction (Ping-Pong) :** Coder un "Eviction Rate Limiter". Un pod ne peut pas √™tre d√©plac√© plus de 2 fois par heure.
* **Cas C - Rate Limiting des APIs Cloud :** Coder un "Circuit Breaker" par provider. Si AWS/GCP/Azure bloque nos requ√™tes, l'agent bascule sur les autres providers et se met en veille 10 minutes pour le provider bloqu√©.
* **Cas D - √âv√©nement mondial impr√©vu (catastrophe, panne massive) :** Le Global Intelligence Engine d√©tecte la surcharge/indisponibilit√© d'une zone et blackliste automatiquement les r√©gions affect√©es du scoring.
* **Cas E - Latence inter-r√©gionale :** Pour les jobs sensibles √† la latence r√©seau, Nerve propose un mode `nerve.io/locality: prefer-local` qui priorise les r√©gions proches tout en gardant le fallback mondial.

---

## 8. ROADMAP DU MVP (Ce qu'on code le Mois 1)
Pour valider le march√© rapidement, on ne construit pas tout le 1er mois.
* **Semaine 1-2 :** Coder l'Agent Go basique (Webhook + Scheduler). Int√©gration stricte √† AWS uniquement (API EC2 Spot).
* **Semaine 3 :** Coder le syst√®me de Graceful Termination (√©couter les signaux AWS de coupure de Spot 2 minutes avant, et √©vacuer les Pods).
* **Semaine 4 :** Un dashboard ultra-basique pour prouver qu'on a fait √©conomiser X dollars sur la semaine test chez notre premier Design Partner (Startup IA).
*(Le mod√®le IA pr√©dictif complexe et le GreenOps viendront en V2).*